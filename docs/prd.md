# Google Ads Campaign Optimization Monitoring System
## Product Requirements Document (PRD)

**最后更新**: 2025-11-15
**版本**: 2.0
**状态**: Phase 1 开发中

---

## 1. 项目背景与愿景

### 1.1 问题陈述

现代广告优化高度依赖优化师的经验和直觉，但这种经验往往：
- **不稳定**：优化师离职后，优化经验随之流失
- **难复现**：无法明确知道"什么操作带来了什么效果"
- **难评估**：难以量化优化师的工作质量和贡献度
- **难学习**：新手优化师缺乏系统化的学习路径

### 1.2 解决方案

本系统旨在建立一个**基于 Google Ads ChangeEvent 的数据驱动优化行为分析平台**，帮助企业回答两个核心问题：

1. **优化师是否对 Campaign 做出了及时、必要、有效的操作？**
2. **哪些操作对 Campaign 的增长最有帮助？哪些操作反而造成负面影响？**

通过 Google Ads API 收集所有广告账户的操作记录（Campaign、AdGroup、Ad、Budget 等），存储在数据库中，并基于操作与后续广告表现的关系，构建"操作效果学习系统"，最终形成：

- ✅ **可量化**：每个操作都有详细记录
- ✅ **可视化**：直观的操作看板和趋势图
- ✅ **可监督**：主管可实时查看团队操作情况
- ✅ **可追责**：明确"谁在什么时间做了什么"

### 1.3 核心价值

**对企业**:
- 建立广告优化的"组织知识库"
- 量化优化师的工作效率和质量
- 降低人员流失带来的知识损失

**对优化师主管**:
- 实时监控团队操作频率和响应速度
- 识别优秀操作模式和风险操作
- 数据驱动的团队绩效评估

**对优化师个人**:
- 清晰的操作历史记录（审计日志）
- 学习优秀同事的操作模式
- 量化展示个人工作贡献

---

## 2. 数据来源：Google Ads ChangeEvent

### 2.1 什么是 ChangeEvent？

ChangeEvent 是 Google Ads API 提供的**广告账户变更日志**，记录了所有对广告资源的修改操作。

**核心特性**:
- **完整记录**：涵盖 Campaign、AdGroup、Ad、Budget、Asset 等所有资源类型
- **字段级粒度**：精确到单个字段的变更（如 budget 从 $50 改为 $100）
- **操作者追踪**：记录用户邮箱、操作时间、操作来源（UI/API/Editor）
- **变更对比**：提供修改前后的完整数据对比
- **近实时**：延迟 0-3 分钟
- **历史查询**：支持查询过去 30 天的变更记录

### 2.2 ChangeEvent 包含哪些信息？

| 信息类型 | 字段示例 | 说明 |
|---------|---------|------|
| **操作信息** | `user_email`, `change_date_time`, `client_type` | 谁、什么时候、通过什么方式操作 |
| **资源信息** | `change_resource_type`, `change_resource_name` | 操作了什么类型的资源 |
| **操作类型** | `resource_change_operation` | CREATE / UPDATE / REMOVE |
| **变更详情** | `changed_fields`, `old_resource`, `new_resource` | 具体改了什么字段、改前改后的值 |
| **关联信息** | `campaign`, `ad_group`, `asset` | 关联的 Campaign/AdGroup |

**示例场景**:
```
用户: huihui.lu@castbox.fm
时间: 2025-11-11 03:02:34
操作: UPDATE
资源: Campaign (id: 23245177362)
变更: amount_micros 从 500000000 改为 1000000000
摘要: Budget increased from $500 to $1000
```

### 2.3 为什么选择 ChangeEvent？

- ✅ **官方数据源**：Google 提供，可靠性高
- ✅ **完整性**：所有操作都会被记录，无遗漏
- ✅ **精确性**：字段级变更，比日志更精确
- ✅ **可扩展性**：支持所有资源类型，未来可扩展分析

---

## 3. 系统目标

### 目标 1：构建优化师行为数据库

从所有 ChangeEvent 中提取结构化的行为记录：

**记录内容**:
- 操作时间
- 操作者（用户邮箱）
- 操作类型（创建、更新、删除）
- 资源类型（Campaign、AdGroup、Budget 等）
- 具体变更字段及其前后值
- 关联的 Campaign/AdGroup

**用途**:
- **审计日志**：谁在什么时候做了什么操作
- **合规检查**：是否有未经授权的操作
- **行为量化**：优化师每天的操作频率和类型分布
- **响应速度**：从广告表现异常到操作响应的时间差

### 目标 2：操作效果分析（Phase 2）

**未来扩展**：在 Phase 2 中，系统将自动分析：

- 每次操作后 24h / 3d / 7d / 28d 内的 Campaign 关键指标变化
- 指标包括：花费、转化、ROAS、Revenue、CPI、CTR、Impressions 等

并建立**操作-效果关系数据库**：
```
操作: Budget 从 $50 增加到 $100
效果: 7 天内 ROAS 从 0.15 提升到 0.22 (+47%)
评分: 正面影响 (+0.8)
```

该评分可用于：
- 优化师绩效评估
- 最佳操作模式识别
- 自动化建议生成

---

## 4. 系统架构（高层视图）

### 4.1 核心模块

```
┌─────────────────────────────────────────────────────┐
│              用户界面 (Web Dashboard)                │
│  ┌─────────────┐  ┌──────────────┐  ┌────────────┐ │
│  │ 事件列表页   │  │ 统计仪表板   │  │ 详情对话框 │ │
│  └─────────────┘  └──────────────┘  └────────────┘ │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│                  API 服务层                          │
│  - 事件列表查询（筛选、分页、排序）                   │
│  - 数据同步（从 Google Ads API 拉取）                │
│  - 统计数据聚合                                      │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│              Google Ads 集成层                       │
│  - 调用 Google Ads API 获取 ChangeEvent             │
│  - 解析 Protobuf 数据格式                           │
│  - 提取字段级变更详情（Deep Diff）                   │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│                 数据存储层                           │
│  - 存储所有 ChangeEvent 记录                        │
│  - 支持高效查询和聚合                                │
│  - 自动去重和索引                                    │
└─────────────────────────────────────────────────────┘
```

### 4.2 数据流

1. **数据采集**: 定期从 Google Ads API 拉取 ChangeEvent 数据
2. **数据解析**: 将 Protobuf 格式转换为结构化数据，提取字段变更
3. **数据存储**: 保存到数据库，包含完整的变更前后对比
4. **数据展示**: 通过 Web 界面展示事件列表和统计图表
5. **数据分析**: （Phase 2）关联广告表现数据，计算操作效果

---

## 5. 核心功能模块

### 模块 A：事件采集与解析

**功能**:
- 从 Google Ads API 获取 ChangeEvent 数据
- 支持指定时间范围查询（如"最近 7 天"）
- 自动解析 Protobuf 格式的复杂嵌套数据
- 提取字段级变更详情（递归 diff 算法）
- 生成人类可读的变更摘要

**输出**:
- 结构化的事件记录
- 完整的字段变更对比
- 操作者、时间、资源类型等元数据

### 模块 B：数据存储

**功能**:
- 存储所有事件记录到数据库
- 自动去重（避免重复拉取）
- 建立索引加速查询
- 支持 JSONB 存储复杂变更详情

**数据组织**:
- 按时间倒序排列（最新的在前）
- 按用户、资源类型、操作类型索引
- 支持模糊搜索（Campaign 名称、资源 ID 等）

### 模块 C：事件查询与筛选

**功能**:
- 事件列表展示（分页、排序）
- 多维度筛选：
  - 按用户邮箱
  - 按资源类型（Campaign、AdGroup 等）
  - 按操作类型（CREATE、UPDATE、REMOVE）
  - 按时间范围
  - 按关键词搜索（Campaign 名称、摘要等）
- 支持导出（CSV/Excel）

**用户体验**:
- 实时搜索和筛选（无需刷新页面）
- 清晰的视觉标识（颜色区分操作类型）
- 点击查看详情对话框

### 模块 D：事件详情展示

**功能**:
- 显示单个事件的完整信息
- 字段变更的前后对比
- 高亮显示差异
- 支持复制 JSON 数据
- 关联 Campaign/AdGroup 的快捷链接

**展示内容**:
- 基础信息：用户、时间、操作类型
- 资源信息：资源类型、资源 ID
- 变更详情：逐字段显示 old → new
- 原始数据：完整的 JSON 数据（可折叠）

### 模块 E：统计仪表板

**功能**:
- 总览统计：
  - 总事件数
  - 活跃用户数
  - 资源类型分布
  - 操作类型分布
- 时间线图表：
  - 每日操作频率趋势
  - 按用户的操作量对比
- 资源类型分布饼图
- 操作类型分布柱状图

**用途**:
- 快速了解团队整体操作情况
- 识别操作高峰时段
- 对比不同用户的活跃度

### 模块 F：数据同步

**功能**:
- 手动触发数据同步（点击按钮）
- 指定同步天数（1-30 天）
- 显示同步进度和结果
- 错误处理和提示

**用户体验**:
- 同步按钮明显
- 进度条反馈
- 成功/失败提示
- 显示同步了多少条新记录

---

## 6. 用户角色与使用场景

### 角色 1：优化师主管

**需求**:
- 查看团队所有成员的操作记录
- 识别优化师的工作频率和质量
- 发现异常操作或风险操作

**使用场景**:
1. 每天早上查看"过去 24 小时的操作统计"
2. 筛选某个优化师的操作历史，评估其工作量
3. 发现某个 Campaign 的 budget 被频繁修改，查看详情
4. 导出操作记录用于周报/月报

### 角色 2：优化师

**需求**:
- 查看自己的操作历史
- 回顾某个 Campaign 的优化过程
- 学习其他优化师的操作模式

**使用场景**:
1. 筛选自己的操作记录，回顾本周做了哪些优化
2. 查看某个 Campaign 的所有历史变更，分析优化效果
3. 搜索"budget 增加"的操作，学习预算调整的最佳实践

### 角色 3：数据分析师

**需求**:
- 导出操作数据用于分析
- 关联操作与广告表现数据
- 构建操作效果模型

**使用场景**:
1. 导出最近 30 天的所有操作记录
2. 分析"budget 增加"操作与 ROAS 变化的关系
3. 识别哪些操作类型对效果影响最大

---

## 7. Phase 1 最终交付物

### 7.1 功能交付

- ✅ **事件列表页**
  - 支持分页、排序、筛选
  - 支持关键词搜索
  - 显示事件摘要

- ✅ **事件详情对话框**
  - 显示完整的字段变更对比
  - 高亮差异字段
  - 支持复制数据

- ✅ **统计仪表板**
  - 总览统计卡片
  - 时间线图表
  - 资源类型分布图
  - 操作类型分布图

- ✅ **数据同步功能**
  - 手动同步按钮
  - 支持指定天数（1-30 天）
  - 同步进度和结果提示

### 7.2 技术交付

- ✅ 完整的 Web 应用（Next.js 全栈）
- ✅ Google Ads API 集成
- ✅ 数据库（PostgreSQL）
- ✅ API 服务层（类型安全）
- ✅ 响应式 UI（Material UI）

### 7.3 文档交付

- ✅ 产品需求文档（PRD）- 本文档
- ✅ 技术设计文档（详见 `tech-design.md`）
- ✅ 开发任务清单（详见 `todo.md`）
- ✅ 部署指南
- ✅ 用户手册

---

## 8. Phase 2-4 扩展规划

### Phase 2: 操作效果分析

- 采集广告表现数据（花费、转化、ROAS 等）
- 计算操作后的指标变化
- 生成操作效果评分
- 操作效果排行榜

### Phase 3: 智能建议

- 基于历史数据的操作建议
- 风险操作识别和预警
- 最佳实践推荐

### Phase 4: 多账户支持

- 支持管理多个 Google Ads 账户
- 跨账户操作对比
- 权限管理（RBAC）

---

## 9. 成功指标

### Phase 1 成功标准

- ✅ 能够成功从 Google Ads API 获取 ChangeEvent 数据
- ✅ 字段变更提取准确率 > 95%
- ✅ 事件列表加载时间 < 1 秒（50 条记录）
- ✅ 支持查询最近 30 天的所有操作
- ✅ UI 响应流畅，无明显卡顿
- ✅ 数据库查询效率高（有索引支持）

### 业务价值指标（Phase 2+）

- 优化师操作频率提升 20%
- 新手优化师上手时间缩短 50%
- 识别出 Top 10% 的高效操作模式
- 减少 30% 的低效操作

---

## 10. 风险与限制

### 10.1 技术风险

- **Google Ads API 限流**：每天有调用次数限制
  - 缓解：合理控制同步频率，使用增量同步

- **数据量增长**：长期积累数据量可能很大
  - 缓解：定期归档历史数据，优化查询性能

### 10.2 业务限制

- **Phase 1 仅支持单个 Google Ads 账户**
  - 后续版本扩展多账户支持

- **Phase 1 不包含操作效果分析**
  - 需要在 Phase 2 集成广告表现数据

### 10.3 数据隐私

- 所有操作记录包含用户邮箱，需妥善保管
- 遵守数据保护法规（GDPR 等）

---

## 附录

### 相关文档

- **技术设计文档**: `docs/tech-design.md`
- **开发任务清单**: `docs/todo.md`
- **系统设计初心**: `googletest/intro.md`（MVP 参考）
- **API 输出示例**: `googletest/googleapioutput.md`

### 术语表

- **ChangeEvent**: Google Ads API 提供的变更事件记录
- **Protobuf**: Google 使用的数据序列化格式
- **Deep Diff**: 递归对比两个对象的所有字段差异
- **oneof**: Protobuf 中的一种数据结构，表示"多选一"
- **ROAS**: Return on Ad Spend，广告支出回报率

---

**文档结束**

详细的技术实现请参考：`docs/tech-design.md`
分阶段开发任务请参考：`docs/todo.md`
