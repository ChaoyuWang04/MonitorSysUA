openapi: 3.0.3
info:
  title: XMP Open API Protocol
  version: "1.0.0"
  description: |
    This OpenAPI fragment describes the common protocol and authentication
    rules for the XMP Open API platform, based on the "Open API Protocol"
    documentation page.

    All XMP Open API requests must:
      - Use JSON request bodies with Content-Type: application/json
      - Include authentication parameters: client_id, timestamp, sign
      - Respect the QPM (queries per minute) rate limit

  x-xmp-notes: |
    This file only defines shared protocol rules and common request/response
    components. Individual API resources (e.g. Ad Report API, Creative Report API)
    should define their own paths and reference the components here.

x-xmp-rate-limit:
  qpm: 10
  description: Maximum 10 requests per minute for each client_id. If exceeded,
    the API will return an error such as "Request Too Frequent".

paths: {}

components:
  schemas:
    AuthParams:
      type: object
      description: |
        Common authentication parameters required in the request body for all
        XMP Open API calls.
      required:
        - client_id
        - timestamp
        - sign
      properties:
        client_id:
          type: string
          description: |
            Unique client identifier. Please contact your admin or sub-admin
            to obtain it and ensure that Open API permissions are activated.
        timestamp:
          type: integer
          format: int64
          description: |
            Unix timestamp (seconds) at the time of the request.
            Default validity period is 30 seconds. If the request is received
            more than 30 seconds after this timestamp, a timeout error may occur.
        sign:
          type: string
          description: |
            Signature string generated by the rule:
              md5(client_secret + timestamp)
            where client_secret is associated with the given client_id.

    CommonRequestBody:
      type: object
      description: |
        Base request body containing authentication parameters and a placeholder
        for API-specific fields. Extend or allOf-reference this schema in
        individual API definitions.
      properties:
        client_id:
          $ref: '#/components/schemas/AuthParams/properties/client_id'
        timestamp:
          $ref: '#/components/schemas/AuthParams/properties/timestamp'
        sign:
          $ref: '#/components/schemas/AuthParams/properties/sign'
        # Additional API-specific parameters should be added per endpoint.
      required:
        - client_id
        - timestamp
        - sign

    ErrorCode:
      type: integer
      description: |
        Standard error codes returned by XMP Open API.
        0      : success
        -1     : generic error
        400001 : error request parameter
      enum:
        - 0
        - -1
        - 400001

    ErrorResponse:
      type: object
      description: Generic error response wrapper.
      properties:
        code:
          $ref: '#/components/schemas/ErrorCode'
        message:
          type: string
          description: Human-readable error message.
      required:
        - code

  responses:
    Success:
      description: Successful operation.
      content:
        application/json:
          schema:
            type: object
            description: |
              Successful response. The exact schema depends on the specific
              API endpoint and should be defined there.
            additionalProperties: true

    Error:
      description: Error response.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  requestBodies:
    AuthenticatedJsonRequest:
      description: |
        Standard JSON request body that must include authentication parameters.
        Extend this in specific APIs with additional properties or use allOf.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CommonRequestBody'

  securitySchemes:
    XmpSignatureAuth:
      type: apiKey
      in: header
      name: X-XMP-SIGN
      description: |
        Logical representation of the signature-based authentication used
        by XMP Open API. The actual implementation requires the following
        parameters in the request (typically in the JSON body or query):
          - client_id
          - timestamp
          - sign = md5(client_secret + timestamp)
        This security scheme exists as a documentation aid only; individual
        endpoints should clearly describe where these fields are located.
